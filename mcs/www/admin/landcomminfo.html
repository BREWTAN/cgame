<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <base href="../" >

    <meta charset="utf-8"/>
    <title>民生宝-联络信息管理</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css">
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-datepicker/css/datepicker3.css"/>
    <link rel='stylesheet' href='assets/global/plugins/jquery-watable/watable.css'/>
    <link rel='stylesheet' href='assets/global/plugins/jquery-watable/animate.min.css'/>

    <script type="text/javascript" src="parts/js/header.js"></script>
    <script type="text/javascript" src="parts/js/wpfcfg.js"></script>
</head>
<body class="page-header-fixed page-quick-sidebar-over-content">
    <script>$.include("parts/pages/topmenu.shtml");</script>
<div class="clearfix">
</div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <script>$.include("parts/pages/sidebar.shtml");</script>

    <!-- END SIDEBAR -->
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <script>$.include("parts/pages/style.shtml");</script>

            <!-- BEGIN PAGE HEADER-->
            <h3 class="page-title">
            系统管理 <small>通用联络信息管理</small>
            </h3>
            <div class="page-bar">
                <ul class="page-breadcrumb">
                    <li>
                        <i class="fa fa-home"></i>
                        <a href="index.html"></a>
                        <i class="fa fa-angle-right"></i>
                    </li>
                    <li>
                        <a href="#"></a>
                    </li>
                </ul>
                <div class="page-toolbar">
                    <div id="dashboard-report-range" class="pull-right tooltips btn btn-fit-height grey-salt" data-placement="top" data-original-title="Change dashboard date range">
                        <i class="icon-calendar"></i>&nbsp;
                        <span class="thin uppercase visible-lg-inline-block">&nbsp;</span>&nbsp;
                        <i class="fa fa-angle-down"></i>
                    </div>
                </div>
            </div>
            <!-- END PAGE HEADER-->
            <div class="note note-success container col-sm-12" style="padding-bottom:0px">
                
       <!--     <div class="col-sm-3 form-group">
                    <div class="btn-group input-group">
                        <div class="input-group-addon">角色ID</div>
                        <input id="find_roleid" class="inputclear form-control" type="text">
                        <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                    </div>
                </div>
        -->        
                <div class="col-sm-3 form-group">
                    <div class="btn-group input-group">
                    <!-- 查询条件控件 -->
                        <div class="input-group-addon">发送方</div>
                        <input id="find_sndMchId" class="inputclear form-control" type="text">
                        <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                    </div>
                </div>
                <div class="col-sm-3 form-group">
                    <div class="btn-group input-group">
                    <!-- 查询条件控件 -->
                        <div class="input-group-addon">接收方</div>
                        <input id="find_rcvMchId" class="inputclear form-control" type="text">
                        <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                    </div>
                </div>
                
                <div class="col-sm-3 form-group">
                    <div class="btn-group input-group">
                    <!-- 查询条件控件 -->
                        <div class="input-group-addon">发送日期起:</div>
                        <input id="find_date_start" class="inputclear form-control" type="text" placeholder="yyyy-mm-dd" data-date-format="yyyy-MM-dd">
                        <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                    </div>
                </div>
                <div class="col-sm-3 form-group">
                    <div class="btn-group input-group">
                    <!-- 查询条件控件 -->
                        <div class="input-group-addon">发送日期止</div>
                        <input id="find_date_end" class="inputclear form-control" type="text" placeholder="yyyy-mm-dd" data-date-format="yyyy-MM-dd">
                        <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                    </div>
                </div>

                <div class="col-sm-2 form-group">
                    <div class="btn-group input-group">
                        <div class="input-group-addon">状态</div>
                        <select class="form-control select2me" id="find_status">
                            <option value="-1">所有</option>
                            <option value="0000">接收成功</option>
                            <option value="0901">待确认</option>
                            <option value="0902">已确认</option>
                        </select>
                    </div>
                </div>

                <div class="col-sm-6 form-group">
                    <script>$.include("parts/pages/crudbtn_send.shtml");</script>
                </div>
            </div>
            <div class="container-fluid">
                <div id="divtable" class="table-responsive container col-md-12" >
                </div>
            </div>
            <div class="clearfix">
            </div>
        </div>
    </div>


    <!-- END CONTENT -->
    <script>$.include("parts/pages/quicksidebar.shtml");</script>

</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->

<script type="text/javascript">$.include("parts/pages/xwatable-form.shtml");</script>
<script>$.include("parts/pages/foot_table.shtml");</script>

<script type="text/javascript">
var statusFormatter=function(){
    return {
        f: function(val){
            if(val&&val==0000) return "接收成功";
            if(val&&val==0901) return "待确认";
            if(val&&val==0902) return "已确认";
            return val;
        },
    };
}();

var messageFormatter=function(){
    return {
        f: function(val){
            //return val;
        	return "<label type='text' id='message' style='display:inline-block;width:300px;'>"+val+"</label>";
        },
    };
}();

var statusEditBuilder=function(val){
    if(val=="0901"){
        return "<select id='resultCode' name='resultCode' class='form-control select2me'><option value='0901' selected>待确认</option><option value='0902' >已确认</option><option value='0000' >接收成功</option></select>";
    }else if(val=="0902"){
        return "<select id='resultCode' name='resultCode' class='form-control select2me'><option value='0901'>待确认</option><option value='0902'  selected>已确认</option><option value='0000' >接收成功</option></select>";
    }else{
        return "<select id='resultCode' name='resultCode' class='form-control select2me'><option value='0901' selected>待确认</option><option value='0902' >已确认</option><option value='0000' >接收成功</option></select>";
    }
};

$(function(){ 
		//初始化页面标题
		initTitle();
		$("#send_button").click(function(){
        	var html = "<br><center><h4>确定发送这条记录吗？</h4></center><br>";
        	html+="<tabel border='1'>"
        	html+="<tr><td><h5 align='left'>发送方&nbsp;&nbsp;：MSCS</h5></td></tr>"
			html+="<tr><td><h5 align='left'>接收方&nbsp;&nbsp;：</h5></td><td><input type='text' name='send_receiver' id='send_receiver'/></td></tr>"
			html+="<tr><td><h5 align='left'>发送消息：</h5></td><td><textarea name='send_message' id='send_message' rows='10' cols='70'></textarea></td></tr>"
			html+="</table>"
        	bootbox.confirm(html,
                    function(result) {
                        if (!result) return;
                        var sendjson = {};
                        sendjson['rcvMchId'] = $("#send_receiver").val();
                        sendjson['message'] =  encodeURIComponent($("#send_message").val());
                        console.log("submit::" + JSON.stringify(sendjson));
                        var ret=Restful.insert(restpath +'/exlandcomminfo', sendjson);
                        xw.autoResetSearch();

                    });
		})
		$("#find_date_start").datepicker({
			format: 'yyyy-mm-dd'
		}); 
		$("#find_date_end").datepicker({
			format: 'yyyy-mm-dd'
		}); 

    var xw=XWATable.init(
        {
            //----------------table的选项-------
            pageSize: 10,                //Initial pagesize
            //filter: true,               //Show filter fields
            sorting: true,              //Enable sorting
            columnPicker: true,         //Show the columnPicker button
            transition: 'fade',  //(bounce, fade, flip, rotate, scroll, slide).
            // pageSizes: [1,5,8,12,200],  //Set custom pageSizes. Leave empty array to hide button.
            // hidePagerOnEmpty: true,     //Removes the pager if data is empty.
            checkboxes: true,           //Make rows checkable. (Note. You need a column with the 'unique' property)
            checkAllToggle:true,        //Show the check-all toggle//+RQLBuilder.like("KEYY", "a").rql()
            //----------------基本restful地址---
            restbase: restpath +'/exlandcomminfo',
            key_column: 'msgId',
            xwattr:"comminfo",
            sortOrder: "desc",
            //---------------行定义
            coldefs: [
                        {      
                            col:"msgId",
                            friendly: "通用信息序号",
                            unique: true,  
                            hidden:true,
                            validate:"required",
                            nonedit:"nosend",
                        },
                        {      
                            col:"sndMchId",
                            friendly: "发送方",
                            nonedit:"nosend",
                        },
                        {
                            col:"rcvMchId",
                            friendly: "接收方",
                            validate:"required",
                            readonly:true
                        },
                        {
                            col:"resultCode",
                            friendly: "平台处理状态",
                            type: "string",
                            format: statusFormatter,
                            inputsource: "custom",
                            hidden:true,
                            inputbuilder: "statusEditBuilder",
                            validate:"required",
                            //nonedit:"nosend",
                        },
                        {
                            col:"message",
                            friendly: "联络信息",
                            inputsource: "textarea",
                            cols: 45,
                            format: messageFormatter,
                            validate:"required",
                            rows: 10,
                            readonly:true
                        },
                        {
                            col:"resultDesc", 
                            friendly: "平台状态描述",
                            nonedit:"nosend",
                        },
                        {
                            col:"recvTime", 
                            friendly: "发送/接收时间",
                            nonedit:"nosend",
                        },
                        {
                            col:"updateTime", 
                            friendly: "更新时间",
                            nonedit:"nosend",
                            sortOrder: "desc",
                        },
                ],
            //---------------查询时过滤条件
            findFilter: function(){//find function
                // RQBuilder.and(rqls)
                var findR=[];

                if($('#find_sndMchId').val().length>0)
                {   
                    findR.push(RQLBuilder.like("sndMchId",$('#find_sndMchId').val()));
                }

                 if($('#find_rcvMchId').val().length>0)
                {   
                    findR.push(RQLBuilder.equal("rcvMchId",$('#find_rcvMchId').val()));
                }
                 if($('#find_date_start').val().length>0)
                {   
                    findR.push(RQLBuilder.condition("recvTime","$gte",$('#find_date_start').val()));
                }
                 if($('#find_date_end').val().length>0)
                {   
                    findR.push(RQLBuilder.condition("recvTime","$lte",$('#find_date_end').val()));
                    //findR.push(RQLBuilder.equal("recvTime",$('#find_date_end').val()));
                }

                console.log("rql="+JSON.stringify(findR));
                
                return RQLBuilder.and(findR).rql();
                
                
            },//--findFilter
            onAdded: function(ret,jsondata){
                console.log("added callback:"+ret+",obj="+JSON.stringify(jsondata));                        
                return  validateForm(ret,jsondata);
                
            },
            onUpdated: function(ret,jsondata){
                console.log("onUpdated callback:"+ret+",obj="+JSON.stringify(jsondata));
                 return  validateForm(ret,jsondata);
            },
            onDeleted: function(ret,jsondata){
                console.log("onDeleted callback:"+ret+",obj="+JSON.stringify(jsondata));
                 setTimeout("refreshTree()", '800');
            },
        }//--init
    );//--end init

    $('#find_rolename').on('input',function(e){
        console.log("changing::"+e.target.value);

        if(!e.target.value){
            xw.autoResetSearch();
        }
    });


    
//-----------------ENDOFSCIPT------
}
);

</script><!-- End of User Script-->
</html>